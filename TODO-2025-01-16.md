# TTS Audify Webapp - Progress Notes

**Date:** January 16, 2025
**Status:** Cleanup complete, extension integration pending

---

## What We Did Today

### Removed Extension-Specific Code (17 files deleted)

**Components:**
- `ContentBlock.vue`, `PredictionBlock.vue`

**Managers (entire directory):**
- `PlayHereManager.ts`, `HighlightingManager.ts`, `BackendIntegrationManager.ts`, `BackendContentManager.ts`, `NativeSelectionManager.ts`

**Stores:**
- `ttsStore.ts`, `contentStore.ts`, `highlightingStore.ts`

**Composables:**
- `useTTSContentController.ts`, `useContentExtractor.ts`

**Utils/Services:**
- `highlighting.ts`, `tagsToSkip.ts`, `languageTags.ts`, `LexRankSummarizer.ts`, `secuirty-config.ts`, `index.d.ts`, `test-minimal-noise.html`

**Modified:**
- `stores/index.ts` - Removed cross-context sync, now just exports pinia + authStore
- `authStore.ts` - Removed `syncStateAcrossContexts` watch

**Build:** Verified working with `bun run build`

---

## What's Left To Do

### Extension-Webapp Auth Flow

Current flow works:
1. User visits webapp
2. Signs up / Logs in
3. Purchases subscription (Stripe)
4. Sees usage dashboard

**Missing steps:**
4. Dashboard shows "Install Extension" button → Chrome Web Store
5. User installs & clicks extension → Extension is logged in

### Decided Approach: httpOnly Cookies + API Check

Most secure option:
- Backend sets `httpOnly` cookie on login
- Extension calls `/api/me` or `/api/validate-token` with `credentials: 'include'`
- Browser sends cookie automatically
- No tokens in localStorage, no sync logic needed

**Requires checking:**
- Is backend currently returning tokens in JSON or setting httpOnly cookies?
- If JSON tokens → need to update backend OR use content script sync approach

---

## Next Steps

1. **Publish extension to Chrome Web Store**
   - Dashboard: https://chrome.google.com/webstore/devconsole
   - Log in with Google account that paid $5 fee

2. **Check backend auth mechanism**
   - Cookies vs JSON tokens?

3. **Add "Install Extension" CTA to webapp**
   - On success page after purchase
   - On dashboard/account page

4. **Update extension to check login status**
   - Call backend API endpoint
   - Pick up session from cookies (or sync from localStorage if needed)

---

## Files Still In Use (Webapp)

```
src/
├── components/
│   ├── LandingPage.vue      # Marketing page
│   ├── SubscriptionPage.vue # Purchase flow
│   ├── SuccessPage.vue      # Post-purchase
│   ├── EmailVerificationPage.vue
│   └── DemoPage.vue
├── shared/
│   ├── stores/
│   │   ├── index.ts         # Pinia setup
│   │   └── authStore.ts     # Auth state
│   ├── composables/
│   │   ├── useStorage.ts    # Auth storage (has useAuthStorage)
│   │   ├── usePolly.ts      # TTS API
│   │   ├── useApiClient.ts
│   │   ├── useBackendIntegration.ts
│   │   └── useAudioSynthesizer.ts
│   ├── utils/
│   │   ├── RuntimeDetection.ts  # Detects extension vs webapp
│   │   ├── analytics.ts
│   │   └── logger.ts
│   ├── config/environment.ts
│   └── constants/
└── pages/*.html             # Entry points
```

---

## Questions To Answer Tomorrow

1. What's the Chrome Web Store URL after publishing?
2. Backend: cookies or JSON tokens?
3. Where exactly should "Install Extension" button go in the UI?
